from nuviAPI.data import labelme
from nuviAPI.s3 import s3_api
from tqdm import tqdm
import json
import os
import os.path as osp
from nuviAPI.hub.utils.datasets import HUB_BUCKET
from nuviAPI.hub.utils.datasets import HUB_IMAGE_PATH
from nuviAPI.hub.utils.datasets import NUVI_BUCKET
from nuviAPI.s3.s3_api import S3API

NUVI_DATA_DEV_BUCKET = "nuvi-data-dev"
SAVE_PATH = "/mnt/nas/data/.hubAPI/coco_2q-mask-labeling.json"

# Make annotation dict
if os.path.exists(SAVE_PATH):
    annotation_dict = json.load(open(SAVE_PATH, "r"))
else:
    gt_uris = s3_api.list_objects(
        "nuvi-data-dev",
        prefixes=[
            "gwangmyeong-gurumsan-dc/231121/L",
            "gurip-guil-dc/231121/L",
            "durumi-dc/231123/L",
            "eunhaengtree-dc/231123/L",
            "dongbingo-dc/231123/L",
            "gurip-suyu1dong-dc/231121/L",
            "malgeunsoop-dc/231123/L",
            "gwangmyeong-gurumsan-dc/231123/L",
            "gwangmyeong-gurumsan-dc/231120/L",
            "haannuri-dc/231121/L",
            "sawoo-es/240304/L",
            "eunhaengtree-dc/231121/L",
            "gurip-suyu1dong-dc/240108/L",
            "he-mang-dc/231123/L",
            "cheonsa-dc/240111/L",
            "gamman-dc/231123/L",
            "dongbingo-dc/231121/L",
            "naju-es/240304/L",
            "gurip-daejo-dc/231121/L",
            "gurip-daejo-dc/231123/L",
            "myeongryun-dc/240112/L",
            "he-mang-dc/231121/L",
            "hanti-dc/231123/L",
            "pinocchio-dc/231120/L",
            "dodamdodam-dc/231123/L",
            "kyungsung-dc/231121/L",
            "kyungsung-dc/231123/L",
            "pinocchio-dc/231122/L",
            "durumi-dc/231121/L",
            "myeongin-dc/231121/L",
            "malgeunsoop-dc/231121/L",
            "haannuri-dc/231123/L",
            "eunhaengtree-dc/231120/L",
            "dongbingo-dc/231120/L",
            "durumi-dc/231120/L",
            "purunsoop-dc/231122/L",
            "oryukdo-dc/231122/L",
            "myeongin-dc/231123/L",
            "myeongryun-dc/231121/L",
            "oryukdo-dc/240108/L",
            "durumi-dc/231122/L",
            "he-mang-dc/231122/L",
            "pyoseon-ms/240304/L",
            "gurip-daejo-dc/231122/L",
            "gurip-daejo-dc/231120/L",
            "gurip-guil-dc/231122/L",
            "gurip-guil-dc/231120/L",
            "dodamdodam-dc/231121/L",
            "hanti-dc/231120/L",
            "pinocchio-dc/231121/L",
            "gwangmyeong-gurumsan-dc/231122/L",
            "he-mang-dc/231120/L",
            "haannuri-dc/231120/L",
            "kyungsung-dc/231120/L",
            "haannuri-dc/231122/L",
            "malgeunsoop-dc/231120/L",
            "malgeunsoop-dc/231122/L",
            "myeongryun-dc/231120/L",
            "oryukdo-dc/231120/L",
            "gamman-dc/231122/L",
            "hanti-dc/231122/L",
            "oryukdo-dc/231123/L",
            "dongbingo-dc/240109/L",
            "kyungsung-dc/231122/L",
            "gurip-suyu1dong-dc/231122/L",
            "gurip-suyu1dong-dc/231120/L",
            "gamman-dc/231120/L",
            "gangjeong-es/240306/L",
            "gangjeong-es/240307/L",
            "gangjeong-es/240401/L",
            "gongsan-es/240513/L",
            "yongdang-dc/231121/L",
            "yanggok-hs/240308/L",
            "yangjae2dong-dc/231120/L",
            "oryukdo-dc/240109/L",
            "yongdang-dc/231120/L",
            "gamman-dc/231121/L",
            "yangjae2dong-dc/231121/L",
            "yangjae2dong-dc/231122/L",
            "yongdang-dc/231123/L",
            "gurip-suyu1dong-dc/240109/L",
            "pyoseon-ms/240304/L",
            "eunhaengtree-dc/231122/L",
            "gangjeong-es/240308/L",
            "suseong-ms/240305/L",
            "cheonsa-dc/240112/L",
            "gangjeong-es/240308/L",
            "seoul-girls-commercial-hs/240307/L",
            "hanti-dc/240109/L",
            "dongbingo-dc/240110/L",
            "choonghyeon-dc/240108/L",
            "yangjae2dong-dc/231123/L",
            "gurip-suyu1dong-dc/240110/L",
            "anchung-ms/240306/L",
            "dongbingo-dc/240111/L",
            "choonghyeon-dc/240109/L",
            "suseong-ms/240305/L",
            "gurip-suyu1dong-dc/231123/L",
            "gurip-guil-dc/231123/L",
            "gangjeong-es/240305/L",
            "gangjeong-es/240401/L",
            "kmoon-es/240513/L",
            "gongsan-es/240308/L",
            "sawoo-es/240304/L",
            "snfl-hs/240307/L",
            "dongbingo-dc/231122/L",
            "gangjeong-es/240307/L",
            "oryukdo-dc/240110/L",
            "hanti-dc/240110/L",
            "anchung-ms/240306/L",
            "gongsan-es/240401/L",
            "gongsan-es/240308/L",
            "gurip-suyu1dong-dc/240111/L",
            "dongbingo-dc/240112/L",
            "songho-hs/240307/L",
            "gongsan-es/240307/L",
            "gongsan-es/240306/L",
            "anchung-ms/240305/L",
            "gongsan-es/240305/L",
            "choonghyeon-dc/240110/L",
            "seoho-es/240304/L",
            "naju-es/240513/L",
            "oryukdo-dc/240111/L",
            "hanti-dc/240111/L",
            "gurip-suyu1dong-dc/240112/L",
            "chunghyun-ms/240306/L",
            "gongsan-es/240401/L",
            "choonghyeon-dc/240111/L",
            "sawoo-es/240308/L",
            "songho-hs/240307/L",
            "gongsan-es/240307/L",
            "gangjeong-es/240306/L",
            "gongsan-es/240306/L",
            "anchung-ms/240305/L",
            "gongsan-es/240305/L",
            "seoho-es/240304/L",
            "bugang-es/240513/L",
            "oryukdo-dc/240112/L",
            "eunhaengtree-dc/240103/L",
            "eunhaengtree-dc/240102/L",
            "gwangmyeong-gurumsan-dc/240108/L",
            "sawoo-es/240513/L",
            "durumi-dc/240109/L",
            "chunghyun-ms/240305/L",
            "wonheung-es/240304/L",
            "choonghyeon-dc/240112/L",
            "gongsan-es/240502/L",
            "sawoo-es/240308/L",
            "yanggok-hs/240307/L",
            "kmoon-es/240307/L",
            "chunghyun-ms/240306/L",
            "pinocchio-dc/240108/L",
            "hanti-dc/240112/L",
            "baeksong-dc/240111/L",
            "choonghyeon-dc/231120/L",
            "bitgaon-dc/231120/L",
            "baeksong-dc/231123/L",
            "baeksong-dc/231120/L",
            "he-mang-dc/240105/L",
            "seoho-es/240520/L",
            "sawoo-es/240510/L",
            "gwangmyeong-gurumsan-dc/240109/L",
            "durumi-dc/240110/L",
            "daeyeon-dc/240110/L",
            "kmoon-es/240306/L",
            "yanggok-hs/240502/L",
            "seoho-es/240308/L",
            "sawoo-es/240307/L",
            "choonghyeon-dc/231121/L",
            "pyoseon-ms/240306/L",
            "chunghyun-ms/240305/L",
            "sawoo-es/240305/L",
            "bitgaon-dc/231123/L",
            "pinocchio-dc/240109/L",
            "he-mang-dc/240108/L",
            "bitgaon-dc/231121/L",
            "kyungsung-dc/240105/L",
            "kyungsung-dc/240104/L",
            "seoho-es/240513/L",
            "gwangmyeong-gurumsan-dc/240110/L",
            "durumi-dc/240111/L",
            "daeyeon-dc/240111/L",
            "seoho-es/240510/L",
            "kmoon-es/240502/L",
            "sawoo-es/240306/L",
            "sehwa-ms/240401/L",
            "wonheung-es/240308/L",
            "sawoo-es/240307/L",
            "sawoo-es/240520/L",
            "pyoseon-ms/240306/L",
            "pyoseon-ms/240305/L",
            "sawoo-es/240305/L",
            "bitgaon-dc/240108/L",
            "haean-es/240304/L",
            "wonheung-es/240513/L",
            "pinocchio-dc/240110/L",
            "he-mang-dc/240109/L",
            "choonghyeon-dc/231122/L",
            "changsin-dc/231120/L",
            "myeongin-dc/240105/L",
            "myeongin-dc/240104/L",
            "myeongin-dc/240103/L",
            "myeongin-dc/240102/L",
            "malgeunsoop-dc/240105/L",
            "saewoomteo-dc/240105/L",
            "malgeunsoop-dc/240104/L",
            "kmoon-es/240520/L",
            "inhwa-es/240513/L",
            "sawoo-es/240306/L",
            "naju-es/240502/L",
            "wonheung-es/240308/L",
            "seoho-es/240307/L",
            "pyoseon-ms/240305/L",
            "gwangmyeong-gurumsan-dc/240111/L",
            "gwangyang-hs/240306/L",
            "haean-es/240304/L",
            "durumi-dc/240112/L",
            "pinocchio-dc/240111/L",
            "he-mang-dc/240110/L",
            "changsin-dc/240111/L",
            "baeksong-dc/240112/L",
            "choonghyeon-dc/231123/L",
            "changsin-dc/231121/L",
            "oryukdo-dc/240105/L",
            "gwangmyeong-gurumsan-dc/240112/L",
            "seoho-es/240306/L",
            "dodamdodam-dc/240108/L",
            "gwangyang-hs/240305/L",
            "changsin-dc/240110/L",
            "bugang-es/240502/L",
            "daeyeon-dc/231120/L",
            "inhwa-es/240308/L",
            "changsin-dc/231122/L",
            "saengmyeongsup-dc/240104/L",
            "seoho-es/240305/L",
            "saengmyeongsup-dc/240103/L",
            "seoho-es/240307/L",
            "hwarang-es/240304/L",
            "pinocchio-dc/240112/L",
            "he-mang-dc/240111/L",
            "saengmyeongsup-dc/240102/L",
            "pinocchio-dc/240105/L",
            "pinocchio-dc/240104/L",
            "seoho-es/240306/L",
            "gwangyang-hs/240305/L",
            "inhwa-es/240520/L",
            "haannuri-dc/240108/L",
            "eunhaengtree-dc/240109/L",
            "wonheung-es/240305/L",
            "bugang-es/240502/L",
            "dodamdodam-dc/240109/L",
            "inhwa-es/240308/L",
            "gwanghui-hs/240306/L",
            "hwarang-es/240304/L",
            "purunsoop-dc/240108/L",
            "he-mang-dc/240112/L",
            "daeyeon-dc/231121/L",
            "saewoogaehana-dc/240105/L",
            "saewoogaehana-dc/240104/L",
            "saengmyeongsup-dc/240105/L",
            "samgye-hs/240521/L",
            "jeonju-seomun-es/240520/L",
            "haannuri-dc/240109/L",
            "sawoo-es/240502/L",
            "wonheung-es/240306/L",
            "jeonju-seomun-es/240308/L",
            "wonheung-es/240307/L",
            "daejeong-w-hs/240305/L",
            "wonheung-es/240305/L",
            "hwbong-es/240304/L",
            "purunsoop-dc/240109/L",
            "kyungsung-dc/240108/L",
            "eunhaengtree-dc/240110/L",
            "dodamdodam-dc/240110/L",
            "daeyeon-dc/231122/L",
            "sangroksu-dc/240102/L",
            "saewoomteo-dc/240104/L",
            "saewoomteo-dc/240103/L",
            "saewoomteo-dc/240102/L",
            "samgye-hs/240522/L",
            "jeonju-hyorim-es/240510/L",
            "haannuri-dc/240110/L",
            "seoho-es/240502/L",
            "jeonju-seoil-es/240308/L",
            "wonheung-es/240306/L",
            "daejeong-w-hs/240305/L",
            "daejeong-w-hs/240306/L",
            "sangroksu-dc/240103/L",
            "inhwa-es/240305/L",
            "hwbong-es/240304/L",
            "purunsoop-dc/240110/L",
            "kyungsung-dc/240109/L",
            "eunhaengtree-dc/240111/L",
            "dodamdodam-dc/240111/L",
            "baeksong-dc/240108/L",
            "daeyeon-dc/231123/L",
            "cheonsa-dc/231121/L",
            "sentber-dc/240103/L",
            "sentber-dc/240102/L",
            "sangroksu-dc/240105/L",
            "sangroksu-dc/240104/L",
            "seoul-girls-commercial-hs/240521/L",
            "saewoogaehana-dc/231123/L",
            "buram-hs/240305/L",
            "haannuri-dc/240112/L",
            "haean-es/240510/L",
            "wonheung-es/240502/L",
            "inhwa-es/240307/L",
            "eunhaengtree-dc/240112/L",
            "changsin-dc/240109/L",
            "buram-hs/240306/L",
            "inhwa-es/240305/L",
            "kwiil-ms/240304/L",
            "purunsoop-dc/240111/L",
            "kyungsung-dc/240110/L",
            "dodamdodam-dc/231120/L",
            "sentber-dc/240105/L",
            "sentber-dc/240104/L",
            "gurip-suyu1dong-dc/240103/L",
            "jeonju-hyorim-es/240520/L",
            "seoho-es/240522/L",
            "hwarang-es/240513/L",
            "haean-es/240306/L",
            "hanti-dc/240108/L",
            "gamman-dc/240108/L",
            "eunhaengtree-dc/240108/L",
            "buram-hs/240305/L",
            "durumi-dc/240108/L",
            "dodamdodam-dc/240112/L",
            "jeonju-seomun-es/240503/L",
            "daeyeon-dc/240112/L",
            "wonheung-es/240502/L",
            "jeonju-hyorim-es/240308/L",
            "jeonju-seomun-es/240307/L",
            "buram-hs/240306/L",
            "dodamdodam-dc/231122/L",
            "haean-es/240305/L",
            "snfl-hs/240522/L",
            "kwiil-ms/240304/L",
            "purunsoop-dc/240112/L",
            "kyungsung-dc/240111/L",
            "gurip-suyu1dong-dc/240102/L",
            "yongsanguchungjikjang-dc/231123/L",
            "hwarang-es/240510/L",
            "haean-es/240520/L",
            "jeonju-seoil-es/240503/L",
            "jeonju-hyorim-es/240308/L",
            "jeonju-seomun-es/240307/L",
            "gamman-dc/240109/L",
            "haean-es/240306/L",
            "dongbingo-dc/240108/L",
            "seoul-girls-commercial-hs/240305/L",
            "haean-es/240305/L",
            "sehwa-ms/240304/L",
            "kyungsung-dc/240112/L",
            "hwbong-es/240520/L",
            "songho-hs/240521/L",
            "seoul-girls-commercial-hs/240305/L",
            "hwarang-es/240305/L",
            "haean-es/240308/L",
            "jeonju-seoil-es/240307/L",
            "seoul-girls-commercial-hs/240306/L",
            "sehwa-ms/240304/L",
            "gamman-dc/240110/L",
            "changsin-dc/240112/L",
            "changsin-dc/240108/L",
            "gangjeong-es/240304/L",
            "malgeunsoop-dc/240108/L",
            "kunkook-university-ms/240520/L",
            "songho-hs/240522/L",
            "hwarang-es/240306/L",
            "yanggok-hs/240521/L",
            "cheonsa-dc/240108/L",
            "jeonju-hyorim-es/240503/L",
            "hwarang-es/240306/L",
            "kongrung-ms/240510/L",
            "snfl-hs/240305/L",
            "manseong-ms/240401/L",
            "haean-es/240308/L",
            "snfl-hs/240306/L",
            "hwarang-es/240305/L",
            "gangjeong-es/240304/L",
            "suseong-ms/240304/L",
            "malgeunsoop-dc/240109/L",
            "saewoomteo-dc/231120/L",
            "kwiil-ms/240513/L",
            "saewoomteo-dc/231123/L",
            "hwbong-es/240306/L",
            "snfl-hs/240305/L",
            "gongsan-es/240304/L",
            "jeonju-hyorim-es/240503/L",
            "gamman-dc/240111/L",
            "hwarang-es/240308/L",
            "jeonju-hyorim-es/240307/L",
            "snfl-hs/240306/L",
            "malgeunsoop-dc/240110/L",
            "cheonsa-dc/240109/L",
            "yongho-hs/240521/L",
            "sehwa-ms/240513/L",
            "sehwa-ms/240510/L",
            "suseong-ms/240304/L",
            "gamman-dc/240112/L",
            "hwbong-es/240306/L",
            "songho-hs/240305/L",
            "kunkook-university-ms/240305/L",
            "anchung-ms/240304/L",
            "haean-es/240503/L",
            "gongsan-es/240304/L",
            "cheonsa-dc/240110/L",
            "sehwa-ms/240520/L",
            "chunghyun-ms/240401/L",
            "hwarang-es/240308/L",
            "yongdang-dc/231122/L",
            "jeonju-hyorim-es/240307/L",
            "songho-hs/240306/L",
            "purunsoop-dc/231123/L",
            "kunkook-university-ms/240306/L",
            "gurip-guil-dc/240109/L",
            "haean-es/240503/L",
            "pyoseon-ms/240401/L",
            "hwbong-es/240308/L",
            "haean-es/240307/L",
            "yanggok-hs/240305/L",
            "yanggok-hs/240306/L",
            "kunkook-university-ms/240305/L",
            "suseong-ms/240513/L",
            "anchung-ms/240304/L",
            "suseong-ms/240520/L",
            "gurip-guil-dc/240112/L",
            "hwarang-es/240503/L",
            "shinlim-ms/240513/L",
            "pyoseon-ms/240401/L",
            "hwbong-es/240308/L",
            "hwarang-es/240307/L",
            "kunkook-university-ms/240306/L",
            "yanggok-hs/240305/L",
            "kongrung-ms/240305/L",
            "chunghyun-ms/240304/L",
            "saewoogaehana-dc/240108/L",
            "myeongin-dc/240108/L",
            "shinlim-ms/240520/L",
            "yongsanguchungjikjang-dc/240103/L",
            "manseong-ms/240510/L",
            "yongsanguchungjikjang-dc/240102/L",
            "hwarang-es/240503/L",
            "kongrung-ms/240306/L",
            "gwangyang-hs/240401/L",
            "gangjeong-es/240305/L",
            "hwarang-es/240307/L",
            "chunghyun-ms/240304/L",
            "saewoogaehana-dc/240109/L",
            "yongsan-dc/240104/L",
            "yongsan-dc/240103/L",
            "myeongin-dc/240109/L",
            "yongsan-dc/240102/L",
            "yongho-dc/240104/L",
            "yongho-dc/240103/L",
            "yangjae2dong-dc/240103/L",
            "yangjae2dong-dc/240102/L",
            "sunhye-dc/240105/L",
            "sunhye-dc/240104/L",
            "sunhye-dc/240103/L",
            "sunhye-dc/240102/L",
            "anchung-ms/240513/L",
            "kwiil-ms/240305/L",
            "daejeong-w-hs/240304/L",
            "gwangyang-hs/240401/L",
            "kunkook-university-ms/240308/L",
            "hwbong-es/240307/L",
            "saewoogaehana-dc/240110/L",
            "myeongin-dc/240110/L",
            "chunghyun-ms/240510/L",
            "kwiil-ms/240306/L",
            "kwiil-ms/240305/L",
            "manseong-ms/240513/L",
            "gwanghui-hs/240401/L",
            "kongrung-ms/240308/L",
            "hwbong-es/240307/L",
            "saewoogaehana-dc/240111/L",
            "myeongin-dc/240111/L",
            "pyoseon-ms/240510/L",
            "manseong-ms/240520/L",
            "kwiil-ms/240306/L",
            "chunghyun-ms/240520/L",
            "hwarang-es/240502/L",
            "sehwa-ms/240305/L",
            "seoul-girls-commercial-hs/240304/L",
            "chunghyun-ms/240513/L",
            "daejeong-w-hs/240401/L",
            "kongrung-ms/240308/L",
            "kunkook-university-ms/240307/L",
            "saewoogaehana-dc/240112/L",
            "myeongin-dc/240112/L",
            "gwangyang-hs/240510/L",
            "sehwa-ms/240306/L",
            "bitgaon-dc/240112/L",
            "baeksong-dc/240109/L",
            "sehwa-ms/240305/L",
            "seoul-girls-commercial-hs/240304/L",
            "kwiil-ms/240503/L",
            "daejeong-w-hs/240401/L",
            "kunkook-university-ms/240307/L",
            "saewoomteo-dc/240108/L",
            "hwbong-es/240502/L",
            "pyoseon-ms/240513/L",
            "saewoomteo-dc/231122/L",
            "sehwa-ms/240306/L",
            "snfl-hs/240304/L",
            "hwarang-es/240522/L",
            "sehwa-ms/240503/L",
            "yongdang-dc/240104/L",
            "hwbong-es/240502/L",
            "kwiil-ms/240308/L",
            "kongrung-ms/240307/L",
            "saewoomteo-dc/240109/L",
            "myeongryun-dc/240108/L",
            "daejeong-w-hs/240510/L",
            "pinocchio-dc/231123/L",
            "snfl-hs/240304/L",
            "bitgaon-dc/240111/L",
            "kwiil-ms/240502/L",
            "sehwa-ms/240308/L",
            "saewoomteo-dc/240110/L",
            "myeongryun-dc/240109/L",
            "hwbong-es/240521/L",
            "yanggok-hs/240304/L",
            "kwiil-ms/240502/L",
            "sehwa-ms/240308/L",
            "kwiil-ms/240307/L",
            "hwbong-es/240522/L",
            "myeongryun-dc/240110/L",
            "gs-tower/etc-gt/240216/L",
            "siripjanghyunyedaum-dc/240104/L",
            "siripjanghyunyedaum-dc/240103/L",
            "myeongryun-dc/240111/L",
            "siripjanghyunyedaum-dc/240102/L",
            "sehwa-ms/240502/L",
            "samgye-hs/240401/L",
            "suseong-ms/240308/L",
            "kwiil-ms/240307/L",
            "bitgaon-dc/240110/L",
            "kunkook-university-ms/240522/L",
            "sehwa-ms/240502/L",
            "samgye-hs/240401/L",
            "suseong-ms/240308/L",
            "sehwa-ms/240307/L",
            "yongsanguchungjikjang-dc/240104/L",
            "anchung-ms/240308/L",
            "sehwa-ms/240307/L",
            "suseong-ms/240307/L",
            "yangjae2dong-dc/240105/L",
            "seoul-girls-commercial-hs/240401/L",
            "anchung-ms/240308/L",
            "manseong-ms/240503/L",
            "suseong-ms/240307/L",
            "snfl-hs/240401/L",
            "chunghyun-ms/240308/L",
            "chunghyun-ms/240503/L",
            "yongsanguchungjikjang-dc/240105/L",
            "songho-hs/240401/L",
            "shinlim-ms/240307/L",
            "sehwa-ms/240522/L",
            "gwangmyeong-gurumsan-dc/240104/L",
            "chunghyun-ms/240503/L",
            "songho-hs/240401/L",
            "pyoseon-ms/240308/L",
            "shinlim-ms/240307/L",
            "sehwa-ms/240521/L",
            "yongsan-dc/240105/L",
            "pyoseon-ms/240503/L",
            "yanggok-hs/240401/L",
            "anchung-ms/240307/L",
            "yongho-dc/240105/L",
            "pyoseon-ms/240503/L",
            "manseong-ms/240502/L",
            "yongho-hs/240401/L",
            "gwangyang-hs/240308/L",
            "purunsoop-dc/231121/L",
            "anchung-ms/240307/L",
            "myeongin-dc/231120/L",
            "gwangyang-hs/240503/L",
            "yangjae2dong-dc/240104/L",
            "manseong-ms/240502/L",
            "yongho-hs/240401/L",
            "chunghyun-ms/240307/L",
            "siripjanghyunyedaum-dc/240105/L",
            "gwangyang-hs/240503/L",
            "chunghyun-ms/240502/L",
            "daejeong-w-hs/240308/L",
            "chunghyun-ms/240307/L",
            "bitgaon-dc/240109/L",
            "daejeong-w-hs/240503/L",
            "chunghyun-ms/240502/L",
            "daejeong-w-hs/240308/L",
            "pyoseon-ms/240307/L",
            "daejeong-w-hs/240503/L",
            "pyoseon-ms/240502/L",
            "busan-fl-hs/240308/L",
            "pyoseon-ms/240307/L",
            "pyoseon-ms/240502/L",
            "buram-hs/240308/L",
            "gwangyang-hs/240307/L",
            "gwangmyeong-gurumsan-dc/240102/L",
            "samgye-hs/240503/L",
            "buram-hs/240308/L",
            "gwangyang-hs/240307/L",
            "seoul-girls-commercial-hs/240308/L",
            "daejeong-w-hs/240307/L",
            "seoul-girls-commercial-hs/240308/L",
            "daejeong-w-hs/240307/L",
            "baeksong-dc/240110/L",
            "snfl-hs/240308/L",
            "buram-hs/240307/L",
            "gurip-suyu1dong-dc/240105/L",
            "seoul-girls-commercial-hs/240503/L",
            "yanggok-hs/240503/L",
            "songho-hs/240308/L",
            "buram-hs/240307/L",
            "cheonsa-dc/231122/L",
            "yanggok-hs/240308/L",
            "seoul-girls-commercial-hs/240307/L",
        ],
        endswith="Trayfile.json",
    )
    labels = ["__ignore__"] + ["food", "package", "bone", "peel", "sauce", "mix_food", "tray", "hand", "cutlery"]
    print(len(gt_uris))

    for i, gt_uri in enumerate(gt_uris):
        gt_uris[i] = f"s3://{NUVI_DATA_DEV_BUCKET}/" + gt_uri

    lc = labelme.ToCOCO(f"s3://{NUVI_BUCKET}", labels=labels, remove_error_image=False)
    lc.json_list = gt_uris
    lc.make_json_ordered()
    lc.set_format()
    lc.set_labels()
    lc.set_categories()

    annotation_dict = lc.__call__()
    image_uris = []
    for img in tqdm(annotation_dict["images"], desc="Converting image paths"):
        ext = img["uri"].split(".")[-1]
        image_uris.append(img["uri"].replace(f"{NUVI_DATA_DEV_BUCKET}", f"{NUVI_BUCKET}"))
        img["uri"] = img["uri"].replace(f".{ext}", ".jpeg")
        img["uri"] = img["uri"].replace(f"s3://{NUVI_DATA_DEV_BUCKET}/", f"s3://{HUB_BUCKET}/{HUB_IMAGE_PATH}/")
        img["file_name"] = img["file_name"].replace(f".{ext}", ".jpeg")
        img["file_name"] = img["file_name"].replace(f"/{NUVI_DATA_DEV_BUCKET}/", "")

    with open(SAVE_PATH, "w") as f:
        json.dump(annotation_dict, f)

    print(f"Saved to {SAVE_PATH}")

    # Upload images to hub bucket (only for the first time)
    # s3 = S3API()
    # s3.upload_compress_image_s3(image_uris, before_path=NUVI_BUCKET, after_path=osp.join(HUB_BUCKET, HUB_IMAGE_PATH))

# Download images to local cache
for img in tqdm(annotation_dict["images"], desc="Downloading images"):
    to_path = f"/mnt/nas/data/.hubAPI/{img['file_name']}"

    if not os.path.exists(to_path):
        os.makedirs(osp.dirname(to_path), exist_ok=True)
        s3_api.download_file(HUB_BUCKET, key=f"{HUB_IMAGE_PATH}/{img['file_name']}", filepath=to_path)
    # break   # for testing
